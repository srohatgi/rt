<!DOCTYPE html> 
<html> 
	<head> 
	<title>My Page</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
</head> 
<body> 
  <div data-role="page">
  	<div data-role="header">
  		<h1>Activity Feeds</h1>
  	</div>

  	<div data-role="content">	
      <b>CONNECTED DEVICES</b>
      <div id="devices"></div>
      <b>FEED</b>
      <div id="feedlist"></div>
  	</div>

    <div id="folder_action" data-role="footer" data-position="fixed"	data-type="horizontal">
        <input id="data" style="width:200px;" />
        <input type="button" id="datasend" value="send" />
    </div>
  </div><!-- /page -->
  
<script>
    var user = prompt("Please enter user name:");
    var socket = io.connect('/?user='+user);

    // on connection to server, ask for user's name with an anonymous callback
    socket.on('connect', function(){
      // call the server-side function 'adddevice' and send one parameter (value of prompt)
      socket.emit('adddevice', user);
    });

    // listener, fills in initial feed
    socket.on('initialfeed', function (feedlist) {
      console.log('feedlist:'+feedlist);
      for (var i=0;i<feedlist.length;i++) {
        $('#feedlist').append(feedlist[i]+'<br/>');
      }
    });

    // listener, updates the feed list
    socket.on('updatefeed', function (feed) {
      $('#feedlist').append(feed + '<br/>');
    });

    // listener, updates the device list
    socket.on('updatedevices', function(data) {
      $('#devices').empty();
      $.each(data, function(key, value) {
        $('#devices').append('<div>' + key + '</div>');
      });
    });

    // on load of page
    $(function(){
      // when the client clicks SEND for simulated folder action
      $('#datasend').click( function() {
        var message = $('#data').val();
        $('#data').val('');
        // tell server to execute 'sendfolderaction' and send along one parameter
        socket.emit('sendfolderaction', message);
      });

      // when the client hits ENTER on their keyboard
      $('#data').keypress(function(e) {
        if(e.which == 13) {
          $(this).blur();
          $('#datasend').focus().click();
        }
      });
    });
</script>
</body>
</html>